<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>5 –∫–ª–∞—Å—Å ‚Äî –ß–∏—Å–ª–æ–≤—ã–µ –∏ –±—É–∫–≤–µ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è ‚Ä¢ –¢–µ–æ—Ä–∏—è + –∏–≥—Ä–∞ + –î–ó</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#f7c6d8; --peach:#ffd8b5; --mint:#c7f2d3; --beige:#fff4e5;
      --ink:#5a2a2a; --ink-soft:#7a4a4a; --accent:#ff9bb3; --ok:#69c28a; --bad:#ff6b6b;
      --bg: radial-gradient(1200px 800px at 10% 10%, #fff7fb 0%, #fff 45%),
            radial-gradient(700px 700px at 90% 20%, #fffaf2 0%, #fff 50%),
            radial-gradient(800px 800px at 20% 90%, #f1fff6 0%, #fff 45%);
      --shadow:0 10px 30px rgba(80,0,40,.08); --radius:20px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Poppins, Nunito, sans-serif; color:var(--ink); background:var(--bg); line-height:1.55;}
    h1,h2,h3{margin:.4em 0 .6em}
    h1{font-size:clamp(24px, 2.5vw + 8px, 40px);} h2{font-size:clamp(18px, 1.6vw + 8px, 28px);}  h3{font-size:clamp(16px, 1.2vw + 8px, 22px);} 
    p, li, label, input, button{font-size:clamp(14px, .9vw + 8px, 18px)}

    .wrap{max-width:1100px; margin:0 auto; padding:24px;}
    .card{background:#fff; border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; margin:14px 0; position:relative; overflow:hidden}
    .card::before{content:""; position:absolute; top:0; left:0; right:0; height:6px; background:linear-gradient(90deg,var(--pink),var(--peach),var(--mint));}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#fff7fb; border:1px solid #ffd8ea; padding:2px 6px; border-radius:6px; transition:transform .12s ease, box-shadow .12s ease}
    .kbd:hover{transform:translateY(-2px); box-shadow:0 6px 16px rgba(255,155,179,.25)}
    .btn{background:linear-gradient(180deg,#fff,#ffeef3); border:none; padding:10px 14px; border-radius:12px; cursor:pointer; box-shadow:var(--shadow); color:#7a2d3a; font-weight:600}
    .btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg, var(--mint), #e0ffe9); color:#1e5133}
    .answers{display:grid; gap:6px; margin-top:6px}

    /* ===== –Ø—Ä–∫–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ç–µ–æ—Ä–∏–∏ */
    h1{background:linear-gradient(90deg,#7a2d3a,#b35a6a); -webkit-background-clip:text; background-clip:text; color:transparent}
    .theory-rich{display:grid; grid-template-columns:1.2fr .8fr; gap:16px; align-items:center}
    .theory-rich .illu{justify-self:end}
    .theory-rich .illu svg{max-width:280px; height:auto; filter:drop-shadow(0 8px 18px rgba(123,45,58,.15))}
    @media (max-width:900px){.theory-rich{grid-template-columns:1fr}.theory-rich .illu{order:-1; justify-self:center}}
    .steps{counter-reset:step}
    .steps li{position:relative; padding-left:44px; margin:10px 0}
    .steps li::before{content:counter(step); counter-increment:step; position:absolute; left:0; top:0; width:28px; height:28px; border-radius:50%; color:#fff; font-weight:700; display:grid; place-items:center; background:linear-gradient(180deg,#ff9bb3,#f7c6d8); box-shadow:var(--shadow)}
    .steps li+li::after{content:''; position:absolute; left:14px; top:-16px; width:2px; height:16px; background:#ffd8ea}

    /* ---- –ò–≥—Ä–∞ ---- */
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .lives{display:flex; align-items:center; gap:6px}
    .lives svg{width:22px; height:22px; fill:#ff7a90; filter:drop-shadow(0 2px 4px rgba(255,0,80,.2))}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700}
    .pill.ok{background:linear-gradient(180deg, #eafff1,#d6ffe7); color:#1a5d38}
    .pill.bad{background:linear-gradient(180deg, #ffeaea,#ffdede); color:#7a3030}
    .progress{height:12px; background:#f3e9ef; border-radius:999px; overflow:hidden}
    .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--mint), var(--accent)); transition:width .5s}
    .game-level{display:none} .game-level.active{display:block}

    .drag-area{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    @media (max-width:800px){.drag-area{grid-template-columns:1fr}}
    .bin{min-height:140px; border-radius:16px; border:2px dashed #f1c6d4; padding:10px; background:#fff; box-shadow:var(--shadow)}
    .bin h4{margin:6px 0 10px}
    .cards{display:flex; flex-wrap:wrap; gap:10px}
    .card-chip{user-select:none; padding:8px 10px; background:linear-gradient(180deg, #fff, #fff7fb); border-radius:12px; box-shadow:var(--shadow); cursor:grab}
    .card-chip.dragging{opacity:.7}

    .inline-input{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .inline-input input{width:10ch; padding:8px 10px; border-radius:10px; border:2px solid #f1d1db; outline:none}

    .expr-builder{display:grid; gap:12px}
    .palette{display:flex; flex-wrap:wrap; gap:8px}
    .token{padding:8px 12px; border-radius:12px; background:linear-gradient(180deg,#fff,#f7fff9); box-shadow:var(--shadow); cursor:pointer}
    .codebox{min-height:48px; padding:10px 12px; background:#10110a08; border:2px dashed #c6ecd2; border-radius:12px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace}
    .codebox .chunk{display:inline-block; padding:4px 6px; margin:4px; background:#fff; border-radius:8px; box-shadow:var(--shadow)}

    .toast{position:fixed; left:50%; top:14px; transform:translateX(-50%) scale(.98); background:#fff; padding:12px 16px; border-radius:16px; box-shadow:0 12px 30px rgba(0,0,0,.12); display:flex; align-items:center; gap:10px; z-index:999; opacity:0; pointer-events:none; transition: .35s ease}
    .toast.show{opacity:1; transform:translateX(-50%) scale(1)}

    .confetti{position:fixed; top:-10px; width:8px; height:12px; background:var(--accent); opacity:.9; z-index:9999; border-radius:2px; animation:fall 1.5s linear forwards}
    @keyframes fall{to{transform:translateY(110vh) rotate(300deg); opacity:0}}
  </style>
</head>
<body>
  <div class="wrap" id="top">
    <h1>–ß–∏—Å–ª–æ–≤—ã–µ –∏ –±—É–∫–≤–µ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</h1>

    <!-- ======= –¢–ï–û–†–ò–Ø ======= -->
    <section class="card" id="theory-what">
      <div class="theory-rich">
        <div class="text">
          <h2>–ß—Ç–æ —Ç–∞–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ?</h2>
          <p><b>–í—ã—Ä–∞–∂–µ–Ω–∏–µ</b> ‚Äì —ç—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ —á–∏—Å–µ–ª, –∑–Ω–∞–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π –∏ –±—É–∫–≤.</p>
          <ul>
            <li><b>–ß–∏—Å–ª–æ–≤–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</b> —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞ –∏ –∑–Ω–∞–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π. –ü—Ä–∏–º–µ—Ä: <span class="kbd">5 ¬∑ 3 + 15 ¬∑ 2</span>.</li>
            <li><b>–ë—É–∫–≤–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</b> —Å–æ–¥–µ—Ä–∂–∏—Ç –±—É–∫–≤—ã (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ). –ü—Ä–∏–º–µ—Ä: <span class="kbd">x + 5</span> –∏–ª–∏ <span class="kbd">2a + 3</span>.</li>
          </ul>
          <p><i>–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:</i> –±–∞—Ç–æ–Ω —Ö–ª–µ–±–∞ —Å—Ç–æ–∏—Ç <span class="kbd">5</span> —Ä., —à–æ–∫–æ–ª–∞–¥ ‚Äì <span class="kbd">15</span> —Ä. –¢–æ–≥–¥–∞ 3 –±–∞—Ç–æ–Ω–∞ –∏ 2 —à–æ–∫–æ–ª–∞–¥–∫–∏ —Å—Ç–æ—è—Ç <span class="kbd">5 ¬∑ 3 + 15 ¬∑ 2</span> —Ä. –≠—Ç–æ —á–∏—Å–ª–æ–≤–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.</p>
          <p>–ê –µ—Å–ª–∏ –æ–±–æ–∑–Ω–∞—á–∏—Ç—å —Ü–µ–Ω—É —Ö–ª–µ–±–∞ —á–µ—Ä–µ–∑ <span class="kbd">x</span>, –∞ —à–æ–∫–æ–ª–∞–¥–∞ —á–µ—Ä–µ–∑ <span class="kbd">y</span>, —Ç–æ –ø–æ–ª—É—á–∞–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ <span class="kbd">x ¬∑ 3 + y ¬∑ 2</span>. –≠—Ç–æ –±—É–∫–≤–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.</p>
          <p><b>–í—ã–≤–æ–¥:</b> —á–∏—Å–ª–æ–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞, –∞ –±—É–∫–≤–µ–Ω–Ω—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–Ω–∞—á–µ–Ω–∏–π.</p>
        </div>
        <div class="illu" aria-hidden="true">
          <svg viewBox="0 0 220 160" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="bag" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0" stop-color="#ffd8b5"/>
                <stop offset="1" stop-color="#fff4e5"/>
              </linearGradient>
            </defs>
            <rect x="60" y="40" width="100" height="100" rx="14" fill="url(#bag)" stroke="#f2c8ad"/>
            <path d="M76 40 q34 -24 68 0" fill="none" stroke="#e0a98c" stroke-width="4"/>
            <rect x="85" y="15" width="18" height="50" rx="6" fill="#f7c6d8" stroke="#e3a7be"/>
            <rect x="120" y="8" width="20" height="60" rx="6" fill="#c7f2d3" stroke="#9ddfb5"/>
            <text x="110" y="150" text-anchor="middle" fill="#7a2d3a" font-family="Nunito" font-size="12">3f + 20</text>
          </svg>
        </div>
      </div>
    </section>

    <section class="card" id="theory-order">
      <div class="theory-rich">
        <div class="text">
          <h2>–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –∏ —Å–∫–æ–±–∫–∏</h2>
          <p>–í–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫:</p>
          <ol class="steps">
            <li>–°–Ω–∞—á–∞–ª–∞ —Å—á–∏—Ç–∞–µ–º <b>–≤ —Å–∫–æ–±–∫–∞—Ö</b>.</li>
            <li>–ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ–º <b>—É–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ</b> (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ).</li>
            <li>–ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ–º <b>—Å–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ</b>.</li>
          </ol>
          <p>–ü—Ä–∏–º–µ—Ä: <span class="kbd">24 ‚àí (6 + 2) ¬∑ 3</span> = <span class="kbd">24 ‚àí 8 ¬∑ 3</span> = <span class="kbd">24 ‚àí 24</span> = <b>0</b>.</p>
          <p><b>–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:</b> –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å 100 —Ä—É–±–ª–µ–π, —Ç—ã –∫—É–ø–∏–ª –ø–∏—Ä–æ–∂–æ–∫ –∑–∞ 30 —Ä—É–±–ª–µ–π –∏ —Ç—Ä–∏ –∫–æ–Ω—Ñ–µ—Ç—ã –ø–æ 10 —Ä—É–±–ª–µ–π, –∑–∞–ø–∏—Å—å –±—É–¥–µ—Ç: <span class="kbd">100 ‚àí (30 + 3 ¬∑ 10)</span>. –°–Ω–∞—á–∞–ª–∞ –≤ —Å–∫–æ–±–∫–∞—Ö, –ø–æ—Ç–æ–º –≤—ã—á–∏—Ç–∞–Ω–∏–µ.</p>
        </div>
        <div class="illu" aria-hidden="true">
          <svg viewBox="0 0 220 160" xmlns="http://www.w3.org/2000/svg">
            <rect x="30" y="40" width="160" height="80" rx="14" fill="#fff7fb" stroke="#ffd8ea"/>
            <text x="110" y="85" text-anchor="middle" font-family="Nunito" font-size="32" fill="#7a2d3a">( ) ¬∑ + ‚àí</text>
            <text x="110" y="135" text-anchor="middle" font-family="Nunito" font-size="14" fill="#b35a6a">—Å–∫–æ–±–∫–∏ ‚Üí —É–º–Ω/–¥–µ–ª ‚Üí —Å–ª–æ–∂/–≤—ã—á</text>
          </svg>
        </div>
      </div>
    </section>

    <section class="card" id="theory-why">
      <div class="theory-rich">
        <div class="text">
          <h2>–ó–∞—á–µ–º –Ω—É–∂–Ω—ã –±—É–∫–≤–µ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è?</h2>
          <p>–ë—É–∫–≤—ã ‚Äì —ç—Ç–æ <b>–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</b>, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º.</p>
          <p><i>–ü—Ä–∏–º–µ—Ä:</i> –ø—É—Å—Ç—å <span class="kbd">s</span> ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –∑–∞ –æ–¥–∏–Ω –∫—Ä—É–≥ —Å—Ç–∞–¥–∏–æ–Ω–∞. –ó–∞ 5 –∫—Ä—É–≥–æ–≤ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å <span class="kbd">5s</span> —à–∞–≥–æ–≤. –ï—Å–ª–∏ <span class="kbd">s=120</span>, —Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è <span class="kbd">600</span> —à–∞–≥–æ–≤. –ï—Å–ª–∏ <span class="kbd">s=150</span>, —Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è <span class="kbd">750</span> —à–∞–≥–æ–≤. –û–¥–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤!</p>
        </div>
        <div class="illu" aria-hidden="true">
          <svg viewBox="0 0 220 160" xmlns="http://www.w3.org/2000/svg">
            <rect x="30" y="30" width="160" height="100" rx="16" fill="#e9fff3" stroke="#c7f2d3"/>
            <circle cx="70" cy="80" r="10" fill="#69c28a"/>
            <circle cx="100" cy="80" r="10" fill="#69c28a"/>
            <circle cx="130" cy="80" r="10" fill="#69c28a"/>
            <circle cx="160" cy="80" r="10" fill="#69c28a"/>
            <text x="110" y="125" text-anchor="middle" font-family="Nunito" font-size="14" fill="#1a5d38">5s —à–∞–≥–æ–≤</text>
          </svg>
        </div>
      </div>
    </section>

    <section class="card" id="theory-mini">
      <h2>–ú–∏–Ω–∏‚Äë–∑–∞–¥–∞–Ω–∏—è –ø—Ä—è–º–æ –≤ —Ç–µ–æ—Ä–∏–∏</h2>
      <p><b>1.</b> –ù–∞–π–¥–∏ –∑–Ω–∞—á–µ–Ω–∏–µ: <span class="kbd">2x + 7</span>, –µ—Å–ª–∏ <span class="kbd">x = 5</span>.</p>
      <p><b>2.</b> –ü–æ–¥—É–º–∞–π: —á—Ç–æ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ <span class="kbd">3p + 2</span>, –µ—Å–ª–∏ <span class="kbd">p</span> ‚Äì —Ü–µ–Ω–∞ —Ä—É—á–∫–∏?</p>
      <p><b>3.</b> –ó–∞–ø–∏—à–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: ¬´—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É—Ç—Ä–æ–º <span class="kbd">t</span>, –¥–Ω—ë–º —Å—Ç–∞–ª–æ –Ω–∞ 6 —Ç–µ–ø–ª–µ–µ¬ª.</p>
    </section>

    <section class="card" id="theory-life">
      <h2>–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã</h2>
      <ul>
        <li><b>–ü–æ–∫—É–ø–∫–∏.</b> –¶–µ–Ω–∞ —Ñ–ª–æ–º–∞—Å—Ç–µ—Ä–∞ ‚Äî <span class="kbd">f</span> —Ä. –ó–∞–ø–∏—Å—å ¬´3 —Ñ–ª–æ–º–∞—Å—Ç–µ—Ä–∞ –∏ –µ—â—ë 20 —Ä –Ω–∞ –Ω–∞–∫–ª–µ–π–∫–∏¬ª ‚Äî —ç—Ç–æ <span class="kbd">3f + 20</span>.</li>
        <li><b>–°–ø–æ—Ä—Ç.</b> –ù–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ –ø–æ –ø–ª–∞–Ω—É <span class="kbd">k</span> –∫—Ä—É–≥–æ–≤. –ï—Å–ª–∏ —Ç—ã –ø—Ä–æ–±–µ–∂–∞–ª –Ω–∞ 2 –∫—Ä—É–≥–∞ –±–æ–ª—å—à–µ, –¥–∏—Å—Ç–∞–Ω—Ü–∏—è ‚Äî <span class="kbd">k + 2</span> –∫—Ä—É–≥–æ–≤.</li>
        <li><b>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞.</b> –£—Ç—Ä–æ–º <span class="kbd">t</span>¬∞–°, –¥–Ω—ë–º —Å—Ç–∞–ª–æ –Ω–∞ 7 —Ç–µ–ø–ª–µ–µ, –≤–µ—á–µ—Ä–æ–º –Ω–∞ 3 —Ö–æ–ª–æ–¥–Ω–µ–µ. –í–µ—á–µ—Ä–æ–º: <span class="kbd">(t + 7) ‚àí 3 = t + 4</span>.</li>
        <li><b>–ü–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞.</b> –°—Ç–æ—Ä–æ–Ω—ã <span class="kbd">a</span> –∏ <span class="kbd">b</span>. –ü–ª–æ—â–∞–¥—å: <span class="kbd">S = ab</span>.</li>
      </ul>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
        <button class="btn primary" id="toGame">–î–∞–ª–µ–µ ‚Üí –ø–µ—Ä–µ–π—Ç–∏ –∫ –∏–≥—Ä–µ</button>
        <span class="pill ok">–ö–∞–Ω–∞–ª: <a href="https://t.me/lera_easy_math" target="_blank" style="color:#1a5d38; text-decoration:none">@lera_easy_math</a></span>
      </div>
    </section>

    <!-- ======= –ò–ì–†–ê ======= -->
    <section class="card" id="game" style="display:none">
      <h2>–ò–≥—Ä–∞: 5 —É—Ä–æ–≤–Ω–µ–π ‚Ä¢ —Ç—Ä–µ–Ω–∏—Ä—É–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è</h2>
      <div class="topbar">
        <div class="lives" id="lives">
          <svg viewBox="0 0 24 24"><path d="M12 21s-7.2-4.35-9.6-8.4C.9 9.9 2.1 6.6 5.1 5.4 7.2 4.5 9.6 5.1 12 7.5c2.4-2.4 4.8-3 6.9-2.1 3 1.2 4.2 4.5 2.7 7.2C19.2 16.65 12 21 12 21z"/></svg>
          <svg viewBox="0 0 24 24"><path d="M12 21s-7.2-4.35-9.6-8.4C.9 9.9 2.1 6.6 5.1 5.4 7.2 4.5 9.6 5.1 12 7.5c2.4-2.4 4.8-3 6.9-2.1 3 1.2 4.2 4.5 2.7 7.2C19.2 16.65 12 21 12 21z"/></svg>
          <svg viewBox="0 0 24 24"><path d="M12 21s-7.2-4.35-9.6-8.4C.9 9.9 2.1 6.6 5.1 5.4 7.2 4.5 9.6 5.1 12 7.5c2.4-2.4 4.8-3 6.9-2.1 3 1.2 4.2 4.5 2.7 7.2C19.2 16.65 12 21 12 21z"/></svg>
        </div>
        <div class="pill ok" id="gameProgress">–£—Ä–æ–≤–µ–Ω—å 1 –∏–∑ 5</div>
        <div style="flex:1 1 100%; height:12px" class="progress"><i id="progressBar" style="width:0%"></i></div>
        <button class="btn" id="resetGame">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
      </div>

      <!-- –£—Ä–æ–≤–µ–Ω—å 1: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ -->
      <div class="game-level active" data-level="1">
        <h3>–£—Ä–æ–≤–µ–Ω—å 1: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h3>
        <p>–û—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã. –ù—É–∂–Ω–æ –¥–∞—Ç—å 4 –≤–µ—Ä–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞.</p>
        <div id="quiz"></div>
        <div style="margin-top:10px"><button class="btn" id="nextFrom1" disabled>–î–∞–ª—å—à–µ ‚Üí</button></div>
      </div>

      <!-- –£—Ä–æ–≤–µ–Ω—å 2: Drag & Drop -->
      <div class="game-level" data-level="2">
        <h3>–£—Ä–æ–≤–µ–Ω—å 2: –†–∞–∑–ª–æ–∂–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
        <p>–ü–µ—Ä–µ—Ç–∞—â–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã.</p>
        <div class="drag-area">
          <div class="bin" data-type="num"><h4>–ß–∏—Å–ª–æ–≤—ã–µ</h4><div class="cards" id="bin-num"></div></div>
          <div class="bin" data-type="let"><h4>–ë—É–∫–≤–µ–Ω–Ω—ã–µ</h4><div class="cards" id="bin-let"></div></div>
        </div>
        <div class="cards" id="pool" style="margin-top:12px"></div>
        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" id="checkDrag">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
          <button class="btn" id="shuffleDrag">–ü–µ—Ä–µ—Å–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏</button>
          <button class="btn" id="nextFrom2" disabled>–î–∞–ª—å—à–µ ‚Üí</button>
        </div>
      </div>

      <!-- –£—Ä–æ–≤–µ–Ω—å 3: –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π -->
      <div class="game-level" data-level="3">
        <h3>–£—Ä–æ–≤–µ–Ω—å 3: –ü–æ–¥—Å—Ç–∞–≤—å –∏ –ø–æ—Å—á–∏—Ç–∞–π</h3>
        <p>–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç—ã (—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞). –ú–∏–Ω–∏–º—É–º 3 –∏–∑ 4 –≤–µ—Ä–Ω–æ.</p>
        <div id="subsTasks" class="grid-two"></div>
        <div style="margin-top:10px"><button class="btn" id="checkSubs">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button> <button class="btn" id="nextFrom3" disabled>–î–∞–ª—å—à–µ ‚Üí</button></div>
      </div>

      <!-- –£—Ä–æ–≤–µ–Ω—å 4: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤—ã—Ä–∞–∂–µ–Ω–∏–π -->
      <div class="game-level" data-level="4">
        <h3>–£—Ä–æ–≤–µ–Ω—å 4: –°–æ–±–µ—Ä–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</h3>
        <p>–ö–ª–∏–∫–∞–π –ø–æ –ø–ª–∏—Ç–∫–∞–º, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –∑–∞–ø–∏—Å—å –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é. –ú–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–∫–µ–Ω –∫–ª–∞–≤–∏—à–µ–π Backspace.</p>
        <div id="builder" class="expr-builder card"></div>
        <div style="margin-top:10px"><button class="btn" id="checkBuild">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button> <button class="btn" id="clearBuild">–û—á–∏—Å—Ç–∏—Ç—å</button> <button class="btn" id="nextFrom4" disabled>–î–∞–ª—å—à–µ ‚Üí</button></div>
      </div>

      <!-- –£—Ä–æ–≤–µ–Ω—å 5: –ú–∏–Ω–∏‚Äë—Å–∏–º—É–ª—è—Ü–∏—è ¬´–ü–æ–∫—É–ø–∫–∏¬ª -->
      <div class="game-level" data-level="5">
        <h3>–£—Ä–æ–≤–µ–Ω—å 5: –ú–∏–Ω–∏‚Äë—Å–∏–º—É–ª—è—Ü–∏—è ¬´–ü–æ–∫—É–ø–∫–∏¬ª</h3>
        <p>–°–æ—Å—Ç–∞–≤—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∏ –ø–æ—Å—á–∏—Ç–∞–π —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö —Ü–µ–Ω–∞—Ö.</p>
        <div class="mini-shop">
          <div class="goods" id="shopGoods"></div>
          <div class="card">
            <div><b>1)</b> –°–æ—Å—Ç–∞–≤—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã <i>S</i>: <span id="shopHint"></span></div>
            <div class="inline-input" style="margin-top:6px">
              <span>S = </span>
              <input type="text" id="shopExpr" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 3p + 2r">
              <button class="btn" id="checkShopExpr">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</button>
            </div>
            <div id="shopExprRes" style="margin-top:6px"></div>
            <hr style="border:none; border-top:1px dashed #f0c6d4; margin:12px 0">
            <div><b>2)</b> –ü–æ—Å—á–∏—Ç–∞–π —Å—É–º–º—É –ø—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏—è—Ö: <span id="shopValues"></span></div>
            <div class="inline-input" style="margin-top:6px">
              <span>S = </span>
              <input type="number" id="shopValue" placeholder="? —Ä—É–±.">
              <button class="btn" id="checkShopValue">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É–º–º—É</button>
            </div>
            <div id="shopValRes" style="margin-top:6px"></div>
            <div style="margin-top:12px"><button class="btn" id="finishGame">–§–∏–Ω–∏—à üéâ</button></div>
          </div>
        </div>
      </div>

    </section>

    <!-- ======= –î–ó (–ø–æ–∫–∞–∂–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ñ–∏–Ω–∏—à–∞) ======= -->
    <section class="card" id="homework" style="display:none">
      <h2>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
      <p>–í—ã–ø–æ–ª–Ω–∏ –ø–∏—Å—å–º–µ–Ω–Ω–æ –≤ —Ç–µ—Ç—Ä–∞–¥–∏.</p>
      <ol>
        <li><b>–°–æ—Å—Ç–∞–≤—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Ç–µ–∫—Å—Ç—É.</b> ¬´–ö—É–ø–∏–ª–∏ <b>3 —Ä—É—á–∫–∏</b> –ø–æ <span class="kbd">p</span> —Ä—É–±–ª–µ–π –∏ <b>2 —Ç–µ—Ç—Ä–∞–¥–∏</b> –ø–æ <span class="kbd">t</span> —Ä—É–±–ª–µ–π¬ª. –ó–∞–ø–∏—à–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏.</li>
        <li><b>–í—ã—á–∏c–ª–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É –¥–µ–π—Å—Ç–≤–∏–π:</b> <span class="kbd">36 ‚àí (4 + 5) ¬∑ 2</span>, <span class="kbd">(30 : 5) + 7 ¬∑ 3</span>.</li>
        <li><b>–ü–æ–¥—Å—Ç–∞–≤—å –∑–Ω–∞—á–µ–Ω–∏—è.</b> –ü—Ä–∏ <span class="kbd">x=6</span> –Ω–∞–π–¥–∏: <span class="kbd">x + 4</span>, <span class="kbd">3x</span>, <span class="kbd">2x + 5</span>.</li>
        <li><b>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è.</b> –û—Ç–º–µ—Ç—å –±—É–∫–≤–µ–Ω–Ω—ã–µ: <span class="kbd">(a+6)¬∑2</span>, <span class="kbd">45‚àí9¬∑4</span>, <span class="kbd">7m‚àí3</span>, <span class="kbd">(20:5)+11</span>, <span class="kbd">3(p+2)</span>.</li>
        <li><b>–ß–µ–ª–ª–µ–Ω–¥–∂ ‚ú®</b> ¬´–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É—Ç—Ä–æ–º ‚Äî <span class="kbd">t</span>. –î–Ω—ë–º —Å—Ç–∞–ª–æ –Ω–∞ 5 —Ç–µ–ø–ª–µ–µ, –≤–µ—á–µ—Ä–æ–º –Ω–∞ 2 —Ö–æ–ª–æ–¥–Ω–µ–µ, —á–µ–º –¥–Ω—ë–º¬ª. –ó–∞–ø–∏—à–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –Ω–∞–π–¥–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ <span class="kbd">t=10</span>.</li>
      </ol>
      <details style="margin-top:10px">
        <summary>–ü–æ–¥—Å–∫–∞–∑–∫–∏/–æ—Ç–≤–µ—Ç—ã (–ø–æ –∫–ª–∏–∫—É)</summary>
        <ul>
          <li>1) <span class="kbd">3p + 2t</span>.</li>
          <li>2) <span class="kbd">36 ‚àí (4+5)¬∑2 = 36 ‚àí 18 = 18</span>; <span class="kbd">(30:5)+7¬∑3 = 6 + 21 = 27</span>.</li>
          <li>3) <span class="kbd">x+4=10</span>, <span class="kbd">3x=18</span>, <span class="kbd">2x+5=17</span>.</li>
          <li>4) –ë—É–∫–≤–µ–Ω–Ω—ã–µ: <span class="kbd">(a+6)¬∑2</span>, <span class="kbd">7m‚àí3</span>, <span class="kbd">3(p+2)</span>.</li>
          <li>5) –í–µ—á–µ—Ä–æ–º: <span class="kbd">(t + 5) ‚àí 2 = t + 3</span>. –ü—Ä–∏ <span class="kbd">t=10</span> ‚Üí <span class="kbd">13</span>.</li>
        </ul>
      </details>
    </section>

    <footer style="margin-top:30px; text-align:center; color:#7a2a3a">
      –°–¥–µ–ª–∞–Ω–æ —Å –∑–∞–±–æ—Ç–æ–π ‚Ä¢ –∫–∞–Ω–∞–ª: <a href="https://t.me/lera_easy_math" target="_blank">@lera_easy_math</a>
    </footer>
  </div>

  <!-- Toast –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ -->
  <div class="toast" id="toast"><span id="toastIcon">üåü</span> <span id="toastMsg">–¢—ã —É–º–Ω–∏—á–∫–∞!</span></div>

  <script>
    // ======= –•–µ–ª–ø–µ—Ä—ã =======
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const toast = (msg, type='ok')=>{ const el = $('#toast'); $('#toastMsg').textContent = msg; $('#toastIcon').textContent = type==='ok' ? 'üåü' : (type==='warn' ? 'üí°' : 'üôà'); el.classList.add('show'); setTimeout(()=> el.classList.remove('show'), 1400); };
    const confetti = ()=>{ for(let i=0;i<20;i++){ const s=document.createElement('span'); s.className='confetti'; s.style.left = Math.random()*100 + 'vw'; s.style.background = ['#ffadc6','#ffd8b5','#c7f2d3','#f7c6d8'][i%4]; document.body.appendChild(s); setTimeout(()=> s.remove(), 1600);} }

    // ======= –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã =======
    const state = { level:1, lives:3, quizCorrect:0, dragSolved:false, subsScore:0, buildSolved:false, shopExprOk:false, shopValOk:false };

    function updateProgress(){
      $('#gameProgress').textContent = `–£—Ä–æ–≤–µ–Ω—å ${Math.min(state.level,5)} –∏–∑ 5`;
      $('#progressBar').style.width = ((state.level-1)/5*100)+'%';
    }
    function loseLife(){ if(state.lives>0){ const heart = $('#lives').children[state.lives-1]; heart.style.filter='grayscale(1) opacity(.4)'; state.lives--; } if(state.lives===0){ toast('–ñ–∏–∑–Ω–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ù–∞—á–Ω—ë–º –∑–∞–Ω–æ–≤–æ','warn'); setTimeout(resetGame,500);} }
    function resetGame(){ state.level=1; state.lives=3; state.quizCorrect=0; state.dragSolved=false; state.subsScore=0; state.buildSolved=false; state.shopExprOk=false; state.shopValOk=false; $$('#lives svg').forEach(s=> s.style.filter=''); $$('.game-level').forEach(l=> l.classList.remove('active')); $('[data-level="1"]').classList.add('active'); $('#nextFrom1').disabled=true; $('#nextFrom2').disabled=true; $('#nextFrom3').disabled=true; $('#nextFrom4').disabled=true; initQuiz(); initDrag(); initSubs(); initBuilder(); initShop(); updateProgress(); }
    function goLevel(n){ state.level=n; $$('.game-level').forEach(l=> l.classList.remove('active')); $(`[data-level="${n}"]`).classList.add('active'); updateProgress(); document.getElementById('game').scrollIntoView({behavior:'smooth'}); }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ —Ç–µ–æ—Ä–∏–∏ –≤ –∏–≥—Ä—É
    $('#toGame').addEventListener('click', ()=>{ document.getElementById('game').style.display='block'; document.getElementById('game').scrollIntoView({behavior:'smooth'}); updateProgress(); });

    // ===== –ù–∞–¥—ë–∂–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å –≤—ã—Ä–∞–∂–µ–Ω–∏–π (–±–µ–∑ eval) =====
    function safeEvalExpr(expr, ctx){
      const s = String(expr).replace(/\s+/g,'');
      const isDigit = c => /[0-9]/.test(c);
      const isLetter = c => /[a-zA-Z]/.test(c);
      const tokens = [];
      for(let i=0;i<s.length;){
        const ch = s[i];
        if(isDigit(ch)){
          let j=i; while(j<s.length && isDigit(s[j])) j++;
          tokens.push({t:'num', v:Number(s.slice(i,j))}); i=j; continue;
        }
        if(isLetter(ch)){
          let j=i; while(j<s.length && isLetter(s[j])) j++;
          const name = s.slice(i,j);
          tokens.push({t:'num', v:Number(ctx[name])}); i=j; continue;
        }
        if('+-*/()'.includes(ch)){ tokens.push({t:'op', v:ch}); i++; continue; }
        // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–æ—á–∫—É —É–º–Ω–æ–∂–µ–Ω–∏—è –∏ –¥—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã
        i++;
      }
      const prec = {'+':1,'-':1,'*':2,'/':2};
      const out=[], stack=[];
      for(const tok of tokens){
        if(tok.t==='num') out.push(tok.v);
        else if(tok.v==='(') stack.push(tok.v);
        else if(tok.v===')'){ while(stack.length && stack[stack.length-1] !== '(') out.push(stack.pop()); stack.pop(); }
        else { while(stack.length && prec[stack[stack.length-1]]>=prec[tok.v]) out.push(stack.pop()); stack.push(tok.v); }
      }
      while(stack.length) out.push(stack.pop());
      const st=[];
      for(const x of out){
        if(typeof x==='number') st.push(x);
        else { const b=st.pop(), a=st.pop(); st.push(x==='+'?a+b:x==='-'?a-b:x==='*'?a*b:a/b); }
      }
      return st.pop();
    }

    // ===== –£—Ä–æ–≤–µ–Ω—å 1: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ =====
    const quizData = [
      {q:'–û—Ç–º–µ—Ç—å –±—É–∫–≤–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ', options:['7 + 4 ¬∑ 2','(a + 3) ¬∑ 2','24 : (6 ‚àí 2)','36 ‚àí 5'], ok:'(a + 3) ¬∑ 2'},
      {q:'–ß–µ–º—É —Ä–∞–≤–Ω–æ 3x –ø—Ä–∏ x=5?', options:['8','15','10','3'], ok:'15'},
      {q:'–ß—Ç–æ —Å–Ω–∞—á–∞–ª–∞ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ 20 ‚àí 4 ¬∑ (2 + 1)?', options:['–í—ã—á–∏—Ç–∞–Ω–∏–µ','–£–º–Ω–æ–∂–µ–Ω–∏–µ','–°–∫–æ–±–∫–∏','–î–µ–ª–µ–Ω–∏–µ'], ok:'–°–∫–æ–±–∫–∏'},
      {q:'–ö–∞–∫ —á–∏—Ç–∞–µ—Ç—Å—è 2x?', options:['–î–≤–∞ –ø–ª—é—Å x','–î–≤–∞ –∏–∫—Å (2 ¬∑ x)','–î–≤–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ x','x –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ'], ok:'–î–≤–∞ –∏–∫—Å (2 ¬∑ x)'},
      {q:'–í—ã–±–µ—Ä–∏ —á–∏—Å–ª–æ–≤–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ', options:['2x + 7','(m + 1) ¬∑ 3','45 ‚àí 6 ¬∑ 2','a : 5'], ok:'45 ‚àí 6 ¬∑ 2'},
    ];
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }
    function initQuiz(){ const cont = $('#quiz'); cont.innerHTML=''; state.quizCorrect=0; const pick = shuffle([...quizData]).slice(0,4); pick.forEach((item, idx)=>{ const card = document.createElement('div'); card.className='card'; card.innerHTML = `<div><b>–í–æ–ø—Ä–æ—Å ${idx+1}.</b> ${item.q}</div>`; const answers = document.createElement('div'); answers.className='answers'; shuffle([...item.options]).forEach(opt=>{ const label=document.createElement('label'); const r=document.createElement('input'); r.type='radio'; r.name='quiz'+idx; r.value=opt; label.append(r, ' '+opt); answers.appendChild(label); }); const btn=document.createElement('button'); btn.className='btn'; btn.textContent='–û—Ç–≤–µ—Ç–∏—Ç—å'; const res=document.createElement('div'); res.className='result'; res.style.marginTop='6px'; btn.addEventListener('click', ()=>{ const val=$('input[name="quiz'+idx+'"]:checked', card)?.value; if(!val){ toast('–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç','warn'); return; } if(val===item.ok){ res.innerHTML='<span class="pill ok">–í–µ—Ä–Ω–æ!</span>'; state.quizCorrect++; btn.disabled=true; confetti(); if(state.quizCorrect>=4){ $('#nextFrom1').disabled=false; toast('–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!'); } } else { res.innerHTML='<span class="pill bad">–ù–µ—Ç, –ø–æ–¥—É–º–∞–π –µ—â—ë.</span>'; loseLife(); } }); card.append(answers, btn, res); cont.appendChild(card); }); }
    $('#nextFrom1').addEventListener('click', ()=> goLevel(2));

    // ===== –£—Ä–æ–≤–µ–Ω—å 2: Drag & Drop =====
    const dragItems = [
      {t:'7 + 5 ¬∑ 2', type:'num'}, {t:'2x + 5', type:'let'}, {t:'(a + 3) ¬∑ 2', type:'let'}, {t:'24 : (6 ‚àí 2)', type:'num'}, {t:'3m ‚àí 1', type:'let'}, {t:'36 ‚àí 18', type:'num'}, {t:'5(p + 2)', type:'let'}, {t:'(30 : 5) + 7', type:'num'},
    ];
    function initDrag(){ $('#bin-num').innerHTML=''; $('#bin-let').innerHTML=''; $('#pool').innerHTML=''; shuffle([...dragItems]).forEach((it)=>{ const c=document.createElement('div'); c.className='card-chip'; c.textContent=it.t; c.draggable=true; c.dataset.type=it.type; c.addEventListener('dragstart', ()=> c.classList.add('dragging')); c.addEventListener('dragend', ()=> c.classList.remove('dragging')); $('#pool').appendChild(c); }); $$('.bin').forEach(bin=>{ bin.addEventListener('dragover', e=> e.preventDefault()); bin.addEventListener('drop', ()=>{ const dragging=$('.card-chip.dragging'); if(dragging) bin.querySelector('.cards').appendChild(dragging); }) }); }
    $('#checkDrag').addEventListener('click', ()=>{ const okNum=$$('#bin-num .card-chip').every(c=> c.dataset.type==='num'); const okLet=$$('#bin-let .card-chip').every(c=> c.dataset.type==='let'); const usedAll=$$('#pool .card-chip').length===0; if(okNum && okLet && usedAll){ toast('–ü–æ—Ä—è–¥–æ–∫!'); confetti(); $('#nextFrom2').disabled=false; } else { toast('–ï—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ —Ç–∞–º','warn'); loseLife(); } });
    $('#shuffleDrag').addEventListener('click', initDrag);
    $('#nextFrom2').addEventListener('click', ()=> goLevel(3));

    // ===== –£—Ä–æ–≤–µ–Ω—å 3: –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ =====
    function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a }
    function initSubs(){ const tasks=[ {expr:'2*x + 5', vars:{x:randInt(2,5)}}, {expr:'3*(m + 2)', vars:{m:randInt(1,6)}}, {expr:'(a + 4) * 2', vars:{a:randInt(1,7)}}, {expr:'30/5 + 2*y', vars:{y:randInt(2,6)}}, ]; const cont=$('#subsTasks'); cont.innerHTML=''; state.subsScore=0; tasks.forEach((t,i)=>{ const correct = Math.round(safeEvalExpr(t.expr, t.vars)); const card=document.createElement('div'); card.className='card'; card.innerHTML=`<div><b>–ó–∞–¥–∞—á–∞ ${i+1}.</b> –ü—Ä–∏ ${Object.entries(t.vars).map(([k,v])=> `${k}=${v}`).join(', ')} –Ω–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è <span class="kbd">${t.expr.replaceAll('*','¬∑')}</span></div>`; const inl=document.createElement('div'); inl.className='inline-input'; const input=document.createElement('input'); input.type='number'; input.placeholder='?'; input.dataset.ok=correct; const btn=document.createElement('button'); btn.className='btn'; btn.textContent='–ü—Ä–æ–≤–µ—Ä–∏—Ç—å'; const res=document.createElement('div'); res.className='result'; btn.addEventListener('click', ()=>{ const val=Number(input.value); if(input.value===''){ toast('–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç','warn'); return; } if(val===Number(input.dataset.ok)) { res.innerHTML='<span class="pill ok">–í–µ—Ä–Ω–æ!</span>'; state.subsScore++; confetti(); btn.disabled=true; } else { res.innerHTML='<span class="pill bad">–ù–µ–≤–µ—Ä–Ω–æ.</span>'; loseLife(); } if(state.subsScore>=3) { $('#nextFrom3').disabled=false; toast('–ú–æ–∂–Ω–æ –¥–∞–ª—å—à–µ!'); } }); inl.append('–û—Ç–≤–µ—Ç: ', input, btn); card.append(inl, res); cont.appendChild(card); }) }
    $('#checkSubs').addEventListener('click', ()=>{ if(state.subsScore>=3) { $('#nextFrom3').disabled=false; toast('–û—Ç–ª–∏—á–Ω–æ!'); } else { toast('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –≤–µ—Ä–Ω—ã—Ö','warn'); }});
    $('#nextFrom3').addEventListener('click', ()=> goLevel(4));

    // ===== –£—Ä–æ–≤–µ–Ω—å 4: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä =====
    const buildTasks=[ {desc:'–°–æ–±–µ—Ä–∏: ¬´—Å—É–º–º–∞ —á–∏—Å–ª–∞ 8 –∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è 3 –∏ x¬ª', allowRegex:/^8\s*\+\s*3\s*\*?\s*x$/}, {desc:'–°–æ–±–µ—Ä–∏: ¬´–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å—É–º–º—ã x –∏ 5 –Ω–∞ 3¬ª', allowRegex:/^(?:3\s*\*?\s*\(?\s*x\s*\+\s*5\s*\)?|\(?\s*x\s*\+\s*5\s*\)?\s*\*?\s*3)$/}, {desc:'–°–æ–±–µ—Ä–∏: ¬´—á–∞—Å—Ç–Ω–æ–µ —Å—É–º–º—ã a –∏ b –∏ —á–∏—Å–ª–∞ 2¬ª', allowRegex:/^\(?\s*a\s*\+\s*b\s*\)?\s*\/\s*2$/}, ];
    let buildIdx=0, buildBuf=[];
    function renderBuilder(){ const root=$('#builder'); root.innerHTML=''; const task=buildTasks[buildIdx]; const title=document.createElement('div'); title.innerHTML=`<b>${task.desc}</b>`; const code=document.createElement('div'); code.className='codebox'; code.id='codebox'; const pal=document.createElement('div'); pal.className='palette'; ['(',')','+','‚àí','-','*','¬∑','/','x','a','b','3','5','8','2'].forEach(t=>{ const btn=document.createElement('button'); btn.type='button'; btn.className='token'; btn.textContent=t; btn.addEventListener('click', ()=>{ buildBuf.push(t); drawBuf(); }); pal.appendChild(btn); }); const tip=document.createElement('div'); tip.style.color='#7a4a4a'; tip.style.fontSize='14px'; tip.textContent='–ü–æ–¥—Å–∫–∞–∑–∫–∞: —É–º–Ω–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∫–∞–∫ * –∏–ª–∏ –±–µ–∑ –∑–Ω–∞–∫–∞ (3x).'; root.append(title, code, pal, tip); drawBuf(); document.onkeydown=(e)=>{ if(e.key==='Backspace'){ buildBuf.pop(); drawBuf(); } } }
    function drawBuf(){ const box=$('#codebox'); box.innerHTML=''; if(buildBuf.length===0){ box.textContent='(–ø—É—Å—Ç–æ)'; box.style.opacity='.6'; } else { box.style.opacity='1'; } buildBuf.forEach(ch=>{ const span=document.createElement('span'); span.className='chunk'; span.textContent=ch==='‚àí' ? '-' : ch; box.appendChild(span); }); }
    function initBuilder(){ buildIdx=0; buildBuf=[]; renderBuilder(); }
    $('#checkBuild').addEventListener('click', ()=>{ const raw=buildBuf.join('').replace(/¬∑/g,'*').replace(/‚àí/g,'-').replace(/\s+/g,''); const ok=buildTasks[buildIdx].allowRegex.test(raw); if(ok){ confetti(); toast('–û—Ç–ª–∏—á–Ω–æ!'); buildIdx++; buildBuf=[]; if(buildIdx<buildTasks.length){ renderBuilder(); } else { $('#nextFrom4').disabled=true; goLevel(5); } } else { toast('–ü–æ–ø—Ä–æ–±—É–π —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å —Å–∫–æ–±–∫–∏/–∑–Ω–∞–∫–∏ –∏–Ω–∞—á–µ','warn'); loseLife(); } });
    $('#clearBuild').addEventListener('click', ()=>{ buildBuf=[]; drawBuf(); });

    // ===== –£—Ä–æ–≤–µ–Ω—å 5: –ü–æ–∫—É–ø–∫–∏ =====
    const shopData = { goods:[ {name:'–¢–µ—Ç—Ä–∞–¥—å', sym:'p', qty:3}, {name:'–†—É—á–∫–∞', sym:'r', qty:2}, ], values:{p:randInt(10,15), r:randInt(20,30)}, expectExpr:/^\s*3\s*\*?\s*p\s*\+\s*2\s*\*?\s*r\s*$/ };
    function initShop(){ const g=$('#shopGoods'); g.innerHTML=''; shopData.goods.forEach(it=>{ const row=document.createElement('div'); row.className='card'; row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.innerHTML=`<div><b>${it.name}</b> (<span class=\"kbd\">${it.sym}</span> —Ä—É–±./—à—Ç)</div><div>–∫–æ–ª-–≤–æ: <span class=\"kbd\">${it.qty}</span></div>`; g.appendChild(row); }); $('#shopHint').innerHTML = `3 —Ç–µ—Ç—Ä–∞–¥–∏ –ø–æ <span class=\"kbd\">p</span> –∏ 2 —Ä—É—á–∫–∏ –ø–æ <span class=\"kbd\">r</span>.`; $('#shopValues').innerHTML = `p = <span class=\"kbd\">${shopData.values.p}</span>, r = <span class=\"kbd\">${shopData.values.r}</span>.`; $('#shopExpr').value=''; $('#shopValue').value=''; $('#finishGame').disabled=false; state.shopExprOk=false; state.shopValOk=false; }
    $('#checkShopExpr').addEventListener('click', ()=>{ const val=$('#shopExpr').value.replace(/¬∑/g,'*'); const ok=shopData.expectExpr.test(val); $('#shopExprRes').innerHTML = ok ? '<span class=\"pill ok\">–í–µ—Ä–Ω–æ: S = 3p + 2r.</span>' : '<span class=\"pill bad\">–ü–æ–¥—É–º–∞–π: 3p + 2r.</span>'; if(ok){ state.shopExprOk=true; confetti(); maybeFinish(); } else { loseLife(); } });
    $('#checkShopValue').addEventListener('click', ()=>{ const v=Number($('#shopValue').value); if($('#shopValue').value===''){ toast('–í–≤–µ–¥–∏ —Å—É–º–º—É','warn'); return; } const target=3*shopData.values.p + 2*shopData.values.r; const ok=v===target; $('#shopValRes').innerHTML = ok ? `<span class=\"pill ok\">–í–µ—Ä–Ω–æ: ${target} —Ä—É–±.</span>` : '<span class=\"pill bad\">–ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–¥—Å—Ç–∞–≤—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ 3p+2r.</span>'; if(ok){ state.shopValOk=true; confetti(); maybeFinish(); } else { loseLife(); } });
    function maybeFinish(){ if(state.shopExprOk && state.shopValOk){ $('#finishGame').disabled=false; } }
    $('#finishGame').addEventListener('click', ()=>{ // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –î–ó –∏ —Å–∫—Ä–æ–ª–ª–∏–º
      document.getElementById('homework').style.display='block';
      document.getElementById('homework').scrollIntoView({behavior:'smooth'});
      toast('–ò–≥—Ä–∞ –ø—Ä–æ–π–¥–µ–Ω–∞! –ú–æ–ª–æ–¥–µ—Ü!');
      confetti(); confetti();
    });

    // ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =====
    function initAll(){ initQuiz(); initDrag(); initSubs(); initBuilder(); initShop(); updateProgress(); }
    initAll();
    $('#resetGame').addEventListener('click', resetGame);
  </script>
</body>
</html>
